<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalle del Caso | Soluciones Migratorias</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Barra superior -->
  <div class="topbar">
    <div style="display:flex; align-items:center; gap:12px;">
      <span>Plataforma exclusiva para clientes de Soluciones Migratorias</span>
      <div style="position:relative;">
        <button id="ddBtn" aria-expanded="false" aria-controls="dropdown">Más información ▼</button>
        <div id="dropdown" class="dropdown">
          Aquí podrá conocer cómo usar esta plataforma para revisar hitos del proceso, próximas fechas y notas relevantes del equipo legal.
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <img src="logo.png" alt="Soluciones Migratorias - Logo">
  </header>

  <!-- Barra informativa -->
  <section class="promo">
    Nuestra página principal |
    <a href="https://solucionesmigratorias.us" target="_blank" rel="noopener">[Visitar sitio web]</a>
  </section>

  <!-- Contenido principal -->
  <main style="flex:1 0 auto; padding:20px;">
    <nav style="margin-bottom:20px; font-size:14px;">
      <a href="index.html">Inicio</a> > <span>Detalle del Caso</span>
    </nav>

    <h1 style="margin-bottom:20px; color:var(--brand-blue);">Detalle del Caso</h1>

    <!-- Tarjetas superiores -->
    <section id="case-top">
      <!-- Tarjeta 1: Información del Cliente -->
      <div class="card">
        <h2>Información del Cliente</h2>
        <div id="cliente-info"></div>
      </div>

      <!-- Tarjeta 2: Fechas de Corte -->
      <div class="card">
        <h2>Fechas de Corte</h2>
        <div id="corte-info"></div>
      </div>
    </section>

    <!-- Actualizaciones -->
    <section class="card" style="margin-top:24px;">
      <h2>Actualizaciones del Caso</h2>
      <div id="updates-list">
        <p>No hay actualizaciones registradas.</p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 | Soluciones Migratorias</p>
  </footer>

  <!-- Scripts -->
  <script>
    // Dropdown
    const btn = document.getElementById('ddBtn');
    const dd = document.getElementById('dropdown');
    btn.addEventListener('click', ()=>{
      const open = dd.style.display === 'block';
      dd.style.display = open ? 'none' : 'block';
      btn.setAttribute('aria-expanded', String(!open));
    });

    // Utilidades
    const params = new URLSearchParams(window.location.search);
    const codigo = params.get('codigo') || '';
    const prefijo = codigo ? codigo.substring(0,3) : null;

    // Ajusta tus fuentes de datos aquí
    const SHEET_URLS = {
      // Ejemplo: "123": "https://sheetdb.io/api/v1/xxxxxxx?sheet=casos"
    };

    // Parsear fechas DD/MM/YYYY -> Date
    function parseDMY(s) {
      // admite "DD/MM/YYYY" o "D/M/YYYY"
      const [d,m,y] = s.split('/').map(Number);
      return new Date(y, (m||1)-1, d||1);
    }

    function renderCliente(info){
      // info: { nombre, documento, codigo, direccion, tipo }
      document.getElementById('cliente-info').innerHTML = `
        <p><strong>Nombre:</strong> ${info.nombre || '-'}</p>
        <p><strong>Documento:</strong> ${info.documento || '-'}</p>
        <p><strong>Código:</strong> ${info.codigo || '-'}</p>
        <p><strong>Dirección:</strong> ${info.direccion || '-'}</p>
        <p><strong>Tipo de Caso:</strong> ${info.tipo || '-'}</p>
      `;
    }

    function renderCorte(corte){
      // corte: { fechaCorte, tipoCorte }
      document.getElementById('corte-info').innerHTML = `
        <p><strong>Fecha de Corte:</strong> ${corte.fechaCorte || '-'}</p>
        <p><strong>Tipo de Corte:</strong> ${corte.tipoCorte || '-'}</p>
      `;
    }

    function renderUpdates(updates){
      const cont = document.getElementById('updates-list');
      if (!updates || !updates.length){
        cont.innerHTML = '<p>No hay actualizaciones registradas.</p>';
        return;
      }

      // Ordenar de más reciente a más antigua
      updates.sort((a,b)=> parseDMY(b.fecha) - parseDMY(a.fecha));

      // Construir lista
      cont.innerHTML = updates.map(u => {
        const fecha = u.fecha || '-';
        const nota = u.nota || '';
        // Fila con fecha a la izquierda (recuadro) y desplegable a la derecha
        return `
          <div class="update-item" style="display:flex; gap:12px; align-items:flex-start; margin:10px 0;">
            <div class="update-date-box" style="
              min-width:90px; text-align:center; background:#f6f8fb; color:#111;
              border:1px solid var(--border); border-radius:8px; padding:8px 10px; font-weight:700;">
              ${fecha}
            </div>
            <details class="update-details" style="flex:1; background:#fff; border:1px solid var(--border); border-radius:8px; padding:10px 12px;">
              <summary style="cursor:pointer; font-weight:700; color:var(--brand-blue); outline:none;">
                Ver actualización
              </summary>
              <div style="margin-top:8px; color:#333; line-height:1.6;">
                ${nota}
              </div>
            </details>
          </div>
        `;
      }).join('');
    }

    async function cargarDatos(){
      // Si tienes un sheet por prefijo, úsalo. Si no, mostramos demo.
      let data = null;

      if (prefijo && SHEET_URLS[prefijo]){
        try{
          const res = await fetch(SHEET_URLS[prefijo]);
          data = await res.json();
          // TODO: mapear tus campos reales desde el sheet a las estructuras de abajo.
        }catch(e){
          console.warn('Error al obtener datos del sheet:', e);
        }
      }

      // DEMO / fallback para visualizar (reemplaza con data real)
      const clienteDemo = {
        nombre: 'Juan Pérez',
        documento: 'CC 123456789',
        codigo: codigo || '—',
        direccion: 'Calle 123 #45-67, Miami, FL',
        tipo: 'Asilo'
      };

      const corteDemo = {
        fechaCorte: '15/10/2025',
        tipoCorte: 'Audiencia Inicial'
      };

      const updatesDemo = [
        { fecha: '01/09/2025', nota: 'Se presentó documentación adicional al tribunal. Se adjuntaron pruebas de domicilio y antecedentes.' },
        { fecha: '15/08/2025', nota: 'Se programó la audiencia inicial. El cliente fue notificado vía correo electrónico.' },
        { fecha: '01/08/2025', nota: 'Se radicó la solicitud de asilo ante la autoridad competente.' }
      ];

      // Render (usa demo si no hay data real mapeada)
      renderCliente(clienteDemo);
      renderCorte(corteDemo);
      renderUpdates(updatesDemo);
    }

    cargarDatos();
  </script>
</body>
</html>
